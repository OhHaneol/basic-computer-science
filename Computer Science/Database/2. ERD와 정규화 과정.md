# 4.2 ERD와 정규화 과정

## **개요**
ERD를 만드는 법과 정규화 과정에 대해서 알아봅니다.

## **목차**

<!-- TOC -->

- [ERD와 정규화 과정](#erd%EC%99%80-%EC%A0%95%EA%B7%9C%ED%99%94-%EA%B3%BC%EC%A0%95)
    - [**개요**](#%EA%B0%9C%EC%9A%94)
    - [**목차**](#%EB%AA%A9%EC%B0%A8)
    - [ERD의 중요성](#erd%EC%9D%98-%EC%A4%91%EC%9A%94%EC%84%B1)
    - [ERD 예제](#erd-%EC%98%88%EC%A0%9C)
    - [정규화 과정](#%EC%A0%95%EA%B7%9C%ED%99%94-%EA%B3%BC%EC%A0%95)
        - [제1정규화1NF](#%EC%A0%9C1%EC%A0%95%EA%B7%9C%ED%99%941nf)
        - [제2정규화2NF](#%EC%A0%9C2%EC%A0%95%EA%B7%9C%ED%99%942nf)
        - [제3정규화3NF](#%EC%A0%9C3%EC%A0%95%EA%B7%9C%ED%99%943nf)
        - [보이스/코드 정규화(BCNF, Boyce-codd Normal Form)](#%EB%B3%B4%EC%9D%B4%EC%8A%A4%EC%BD%94%EB%93%9C-%EC%A0%95%EA%B7%9C%ED%99%94bcnf-boyce-codd-normal-form)
    - [**참고 자료**](#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C)

<!-- /TOC -->

---

## ERD의 중요성

- ERD 개념
    - ERD(Entity Relationship Diagram)는 릴레이션 간의 관계를 정의한 것으로, 데이터베이스 구축 시 뼈대 역할을 한다.
- 장점
    - 관계형 구조로 표현할 수 있는 데이터를 구성하는 데 유용할 수 있다.
- 단점
    - **비정형 데이터**를 충분히 표현할 수 없다.
        > **비정형 데이터**: 비구조화 데이터를 말하며, 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보를 말한다.

## ERD 예제

- <수강신청> 서비스 요구사항
    - 학적과에는 각 과목을 강의하는 강사, 등록한 학생, 강의가 이루어지는 시간(여러개의 값) 및 장소 등의 데이터가 유지된다.
    - 한 강사가 여러 개의 과목을 강의할 수 있으며, 각 과목과 학생 간에는 학점이 부여된다.
    - 과목에 대해서는 과목번호, 과목명 등의 정보가 유지되어야 한다.
    - 강사에 대해서는 강사번호, 이름, 나이, 성별 등의 정보가 유지되어야 한다.
    - 학생에 대해서는 학번, 이름, 주소 등의 정보가 유지되어야 한다.
- ERD 도출 과정
    1. 먼저 요구사항에서 엔터티를 추출해보면 강사, 과목, 학생 크게 세가지가 보인다. 또한 강의가 이루어지는 시간이 여러 타임이 있고, 과목을 수강한 학생들은 학점을 부여받는다.
    2. 세가지 엔티티 간의 관계에 대해 정리를 해보면 다음과 같다.
        - 강사 - 과목 => 1 : M
        - 과목 - 학생  => M : N
    3. 여기에 강의시간을 추가해야하며, 과목과 학생의 M:N의 관계에 Mapping 엔티티를 만들어줘야 한다.
        - 과목 - 강의 시간 => 1 : M
        - 학생 - 수강하는 과목 => 1 : M
    4. 이제 만들어야 하는 엔티티는 총 5가지이다. 강사, 과목, 수강과목, 학생, 강의정보(강의시간 포함)
    5. 엔티티의 각 속성을 기반으로 관계와 선택성(옵션)를 판단하여 ERD를 작성한다.
        <img alt="수강신청 ERD" src="">

## 정규화 과정

- 개념
    - 정규화 과정은 **정규형 원칙**을 기반으로 정규형을 만들어가는 과정이다.
    - 릴레이션간의 잘못된 종속 관계로 인해 데이터베이스 **이상 현상**이 일어나서 이를 해결하는 것을 말한다.
    - 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정을 말한다.
        > **정규형 원칙**: 같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고, 자료의 중복성은 감소해야 하고, 독립적인 관계는 별개의 릴레이션으로 표현해야 하며, 각각의 릴레이션은 독립적인 표현이 가능해야 하는 것을 말한다.

        > **이상 현상**의 종류
        > - 갱신 이상: 중복된 데이터 중 일부를 갱신할 때 의도치 않은 데이터가 갱신됨으로써 생기는 데이터의 불일치
        > - 삽입 이상: 새 데이터를 삽입할 때 의도치 않은 데이터가 삽입됨으로써 생기는 데이터의 불일치
        > - 삭제 이상: 데이터를 삭제할 때 의도치 않은 데이터까지 삭제됨으로써 생기는 데이터의 불일치
- 장점
    - 데이터베이스 변경 시 이상 현상(Anomaly)을 제거할 수 있다.
    - 정규화된 데이터베이스 구조에서는 새로운 데이터 형의 추가로 인한 확장 시, 그 구조를 변경하지 않아도 되거나 일부만 변경해도 된다.
    - 데이터베이스와 연동된 응용 프로그램에 최소한의 영향만을 미치게 되어 응용프로그램의 생명을 연장시킨다.
- 단점
    - 릴레이션의 분해로 인해 릴레이션 간의 JOIN 연산이 많아져 성능이 저하될 수 있다.
    - 질의에 대한 응답 시간이 느려질 수도 있다.(데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수도 있다.)
- 비고
    - 보통 3NF까지 도달하면 정규화 되었다고 말하고, 실무에서는 3NF 또는 BCNF 까지만 진행한다.

### 제1정규화(1NF)

- 개념
    - 테이블의 컬럼이 **원자값(Atomic Value, 하나의 값)을 갖도록 테이블을 분해**하는 것을 의미한다.
- 성립 조건
    - 각 컬럼이 **하나의 속성**만을 가져야한다.
    - 하나의 컬럼은 같은 종류나 타입(type)의 값을 가져야한다.
    - 각 컬럼이 유일한 이름을 가져야한다.
    - 칼럼의 순서가 상관없어야한다.
- 예시
    - 원래 테이블
        |이름|나이|수강과목|
        |--|--|--|
        |홍길동|20|C,C++|
        |이순신|21|Java|
        |이 산|22|DB, 운영체제|
        - 수강과목이 두 개 이상의 속성을 가지고 있기 때문에, 튜플을 추가하여 제1정규화를 아래와 같이 진행할 수 있다.
    - 제1정규화를 적용한 테이블
        |이름|나이|수강과목|
        |--|--|--|
        |홍길동|20|C|
        |홍길동|20|C++|
        |이순신|21|Java|
        |이 산|22|DB|
        |이 산|22|운영체제|

### 제2정규화(2NF)

- 개념
    - 제1정규화를 진행한 테이블에 대해 **완전 함수 종속**을 만족하도록 테이블을 분해하는 것을 의미한다.
        > **완전 함수 종속**: 기본키의 부분집합이 **결정자**가 되어선 안된다는 것을 의미한다.
        > **결정자**: 함수 종속 관계에서 특정 종속자를 결정짓는 요소로, 'X->Y' 에서 X는 결정자, Y는 종속자이다.
- 성립 조건
    - 제1정규화를 만족해야한다.
    - 모든 컬럼이 부분적 종속(Partial Dependency)이 없어야한다. 다시 말해 모든 칼럼이 완전 함수 종속을 만족해야한다.
- 예시
    - 학생 테이블(원래 테이블)
        |이름|나이|수강과목|
        |--|--|--|
        |홍길동|20|C|
        |홍길동|20|DB|
        |이순신|21|Java|
        |이 산|22|DB|
        |이 산|22|운영체제|
        - 중복데이터로 인해 이름으로 행을 구분할 수 없고 나이 또한 행을 구분할 수 없다.
        - 이름과 수강과목 두 가지를 합친 [이름, 수강과목] 기본키로만 각 ROW를 구분할 수 있다.
        - 이는 다르게 말해 학생이름과 수강과목을 알면 나이를 알 수 있다는 말이 되기도 하는데
        - 여기서 나이는 학생이름에 종속되어져 있기에 학생이름 하나만 알더라도 나이를 알 수 있다는 문제가 생긴다.
        - 이렇게 기본키 중에 특정 컬럼에만 종속된 컬럼이 존재할 경우 2차 정규형에 위배된다.
        - 이를 해결하기 위해 제 2정규화를 실행하며 제 2정규화를 거치면 아래와 같다.
    - 학생 테이블
        |이름|나이|
        |--|--|
        |홍길동|20|
        |이순신|21|
        |이 산|22|
    - 과목 테이블
        |이름|수강과목|
        |--|--|
        |홍길동|C|
        |홍길동|DB|
        |이순신|Java|
        |이 산|DB|
        |이 산|운영체제|

### 제3정규화(3NF)

- 개념
    - 제2정규화를 진행한 테이블에 대해 **이행적 함수 종속**을 없애도록 테이블을 분해하는 것을 의미한다.
        > **이행적 함수 종속**: A->B, B->C가 성립할 때 A->C가 성립되는 것을 의미한다.
- 성립 조건
    - 제2정규화를 만족해야한다.
    - 기본키를 제외한 속성들 간의 이행적 함수 종속을 만족하지 않아야 한다.
- 이행적 함수 종속 예시
    - 원래 테이블
        |유저 ID|등급|할인율|
        |--|--|--|
        |홍철|플래티넘|30%|
        |범수|다이아|50%|
        |기범|마스터|70%|
    - 이행적 함수 종속이 적용되는 테이블 두 개
        - 테이블 1
            |유저 ID|등급|
            |--|--|
            |홍철|플래티넘|
            |범수|다이아|
            |기범|마스터|
        - 테이블 2
            |등급|할인율|
            |--|--|
            |플래티넘|30%|
            |다이아|50%|
            |마스터|70%|


### 보이스/코드 정규화(BCNF, Boyce-codd Normal Form)

- 개념
    - 3차 정규화를 만족하면서 모든 결정자가 후보키 집합에 속한 정규형을 의미한다.
- 성립 조건
    - 제 3 정규화를 만족해야 한다.
    - 모든 결정자가 후보키 집합에 속해야 한다.
- 예시
    - 원래 테이블
        |학생|과목|교수|학점|
        |--|--|--|--|
        |1|AB123|김인영|A|
        |2|CS123|Mr.Sim|A|
        |3|CS123|Mr.Sim|A|
        - 데이터가 중복된다.
        - '김인영'교수가 새로운 강의를 열었을 때 학생이 NULL 이 나오는 갱신 이상이 발생할 수 있다.
    - 보이스코드 정규화를 적용해서 나눠진 테이블 두 개
        - 교수 테이블
            |교수|과목|
            |--|--|
            |김인영|AB123|
            |Mr.Sim|CS123|
        - 수강 테이블
            |학생|과목|학점
            |--|--|--|
            |1|AB123|A|
            |2|CS123|A|
            |3|CS123|A|

---

## **참고 자료**

- 관련 서적
    - [면접을 위한 CS 전공지식 노트(주홍철)](https://product.kyobobook.co.kr/detail/S000001834833?utm_source=google&utm_medium=cpc&utm_campaign=googleSearch&gt_network=g&gt_keyword=&gt_target_id=aud-901091942354:dsa-435935280379&gt_campaign_id=9979905549&gt_adgroup_id=132556570510&gad_source=1&gclid=Cj0KCQjwwYSwBhDcARIsAOyL0fhby9LTtW8HLZ5Wg0aW9oKf_EyHPNtAttNCtkeyvmU4HlWw4sGx6VYaAnT5EALw_wcB)
- 블로그
    - [정규화](https://superohinsung.tistory.com/111)
    - [[ Database ] 제 1정규화, 제 2정규화, 제 3정규화](https://mjn5027.tistory.com/46)
- 이미지 출처
    - [수강신청 ERD](https://rang22.tistory.com/21)